<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wavefy Music</title>

<style>
:root{
  --blue:#38bdf8;
  --blue2:#0ea5e9;
  --bg:#020617;
  --card:#020617;
  --text:#e5e7eb;
  --muted:#94a3b8;
}
*{box-sizing:border-box;font-family:system-ui,sans-serif}
body{
  margin:0;
  background:#020617;
  color:var(--text);
}
header{
  padding:18px;
  text-align:center;
  font-weight:800;
  font-size:22px;
  background:linear-gradient(135deg,var(--blue),var(--blue2));
  color:#020617;
}
.player{
  margin:20px;
  background:#020617;
  border-radius:18px;
  padding:16px;
  box-shadow:0 20px 40px rgba(0,0,0,.5);
}
#frame{
  width:100%;
  aspect-ratio:16/9;
  border-radius:14px;
  border:none;
}
.song-title{font-weight:700;font-size:18px;margin-top:10px}
.song-artist{font-size:13px;color:var(--muted)}
.add{
  margin:20px;
  display:flex;
  gap:10px;
}
.add input{
  flex:1;
  padding:12px;
  border-radius:12px;
  border:none;
}
.add button{
  padding:12px 16px;
  border:none;
  border-radius:12px;
  background:var(--blue);
  font-weight:700;
  cursor:pointer;
}
.playlist{margin:20px}
.track{
  padding:14px;
  border-radius:14px;
  background:#020617;
  margin-bottom:10px;
  cursor:pointer;
  transition:.25s;
}
.track:hover{transform:scale(1.02)}
.track.active{
  background:linear-gradient(135deg,var(--blue),var(--blue2));
  color:#020617;
}
.track small{color:var(--muted)}
.hint{
  text-align:center;
  font-size:12px;
  color:var(--muted);
  margin-bottom:30px;
}
</style>
</head>
<body>

<header>ðŸŒŠ Wavefy Music</header>

<div class="player">
  <iframe id="frame" allow="autoplay"></iframe>
  <div class="song-title" id="title">Belum ada lagu</div>
  <div class="song-artist" id="artist">Tempel link YouTube / SoundCloud</div>
</div>

<div class="add">
  <input id="urlInput" placeholder="Tempel link YouTube atau SoundCloud">
  <button onclick="addSong()">Tambah</button>
</div>

<div class="playlist" id="playlist"></div>
<div class="hint">Klik lagu untuk play â€¢ Tekan lama untuk hapus</div>

<script>
/* =========================
   DEFAULT EMBEDDED SONGS
   =========================
   ðŸ‘‰ GANTI / TAMBAH LAGU DI SINI
*/
const defaultSongs = [
  {
    title: "Bohemian Rhapsody",
    artist: "Queen",
    embed: "https://m.soundcloud.com/patmyers/bohemian-rhapsody"
  }
];

/* =========================
   LOAD SONGS
   ========================= */
let songs = JSON.parse(localStorage.getItem("wavefySongs"));

if (!songs || songs.length === 0) {
  songs = defaultSongs;
  localStorage.setItem("wavefySongs", JSON.stringify(songs));
}

let current = -1;

function saveSongs(){
  localStorage.setItem("wavefySongs", JSON.stringify(songs));
}

function isYouTube(url){
  return url.includes("youtube.com") || url.includes("youtu.be");
}
function getYTid(url){
  let m=url.match(/(youtu\.be\/|v=)([^&]+)/);
  return m?m[2]:null;
}

async function addSong(){
  let url=urlInput.value.trim();
  if(!url) return;

  let data,embed;

  try{
    if(isYouTube(url)){
      let id=getYTid(url);
      if(!id) return alert("Link YouTube tidak valid");
      let r=await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${id}&format=json`);
      data=await r.json();
      embed=`https://www.youtube.com/embed/${id}?autoplay=1`;
    }else{
      let r=await fetch(`https://soundcloud.com/oembed?format=json&url=${encodeURIComponent(url)}`);
      data=await r.json();
      embed=data.html.match(/src="([^"]+)"/)[1];
    }

    songs.push({
      title:data.title,
      artist:data.author_name,
      embed
    });

    saveSongs();
    urlInput.value="";
    render();

  }catch{
    alert("Gagal ambil data lagu");
  }
}

function render(){
  playlist.innerHTML="";
  songs.forEach((s,i)=>{
    let d=document.createElement("div");
    d.className="track"+(i===current?" active":"");
    d.innerHTML=`<b>${s.title}</b><br><small>${s.artist}</small>`;

    d.onclick=()=>play(i);

    let pressTimer;
    d.addEventListener("pointerdown", ()=>{
      pressTimer=setTimeout(()=>{
        if(confirm("Hapus lagu ini?")){
          songs.splice(i,1);
          saveSongs();
          if(current===i){
            frame.src="";
            current=-1;
            title.textContent="Belum ada lagu";
            artist.textContent="";
          }
          render();
        }
      },600);
    });
    d.addEventListener("pointerup", ()=>clearTimeout(pressTimer));
    d.addEventListener("pointerleave", ()=>clearTimeout(pressTimer));

    playlist.appendChild(d);
  });
}

function play(i){
  current=i;
  frame.src=songs[i].embed;
  title.textContent=songs[i].title;
  artist.textContent=songs[i].artist;
  render();
}

// auto load
render();
</script>

</body>
</html>
